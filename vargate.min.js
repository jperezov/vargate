/**!
 * vargate v0.8.1
 * Copyright (c) 2017 Jonathan Perez.
 * Licensed under the MIT License.
 */
!function(){"use strict";function VarGate(moduleName,parent){function addCallback(a,b,c,d,e){var f,g,h;d=d||this,"undefined"==typeof gate[a]&&(gate[a]={vars:[],cond:{},fn:c,module:this,context:d}),Array.isArray(b)?2===b.length?(f=util.guid()+":"+b[1].replace(/\./g,"-"),h="!==",g=void 0,assignNestedPropertyListener(b[0],b[1],f,d)):3===b.length?(f=b[0],h=b[1],g=b[2],g&&g.toString().match(/^@\w+$/)&&e!==!0&&addCallback(a,[g.slice(1),h,"@"+f],c,d,!0)):util.throw("Invalid number of arguments passed through: ["+b.join(",")+"] (should be [key, operator, condition])"):(f=b,h="!==",g=void 0);try{gate[a].vars.push(f),gate[a].cond[f]={operator:h,val:g},"undefined"==typeof gateMap[f]&&(gateMap[f]={deps:0,namespace:{}}),gateMap[f].namespace[a]=!0,gateMap[f].deps++,f.indexOf(".")!==-1&&subKeyWaitCount++}catch(i){util.throw('Cannot set "'+JSON.stringify(b)+'" as a property')}}function checkValue(a,b){"undefined"!=typeof b||util.squelch()||util.throw('"'+a+'" set to `undefined`. Was this intentional? Use `unset("'+a+'")` if it was.')}function checkDefined(a){data[this.moduleName+"."+a]||"undefined"==typeof parent.get(a)||util.squelch()||util.throw('In "'+this.moduleName+'" variable "'+a+'" defined in module "'+parent.moduleName+'". Choose a different name.')}function assignNestedPropertyListener(a,b,c,d){var e=b.split(".");1===e.length&&"string"==typeof b?(b=b.replace(/[^\w$]/g,""),void 0===a[b]?Object.defineProperty(a,b,{configurable:!0,set:function(e){delete a[b],a[b]=e,d.set(c,a)}}):d.set(c,a)):assignNestedPropertyListener(a[e[0]],e.splice(1).join("."),c,d)}var self=this,children={},data={},gate={},gateMap={},subKeyWaitCount=0;this.moduleName=moduleName,"verbose"===window.DEBUG_MODE&&!function(a){a.parent=parent,a.children=children,a.data=data,a.gate=gate,a.gateMap=gateMap,a.subKeyWaitCount=subKeyWaitCount}(this),this.register=function(a){var b=arguments[1]||children,c=this.moduleName===self.moduleName?self.moduleName+"."+a:a;return parent?parent.register.call(this,c,b):(util.log('Registering "'+c+'"',!0),children[c]=b[c]=new VarGate(c,this),children[c])},this.new=function(a){return util.log('Creating new "'+a+'"',!0),new VarGate(a)},this.on=function(a,b,c){this.when(a,[b,!0],c)},this.when=function(a,b,c){var d=this.moduleName+"."+util.guid();if(parent)parent.when.call(this,a,b,c);else if(a.length&&"string"!=typeof a){util.log(['Waiting in "'+this.moduleName+'" for',a],!0);for(var e in a)a.hasOwnProperty(e)&&addCallback.call(this,d,a[e],b,c||this);this.unlock(a[0])}else util.log(['Waiting in "'+this.moduleName+'" for',a],!0),addCallback.call(this,d,a,b,c||this),this.unlock(a)},this.set=function(a,b){var c=arguments[2]||data,d=this.moduleName===self.moduleName?this.moduleName+"."+a:arguments[3],e=a.split(".");e&&e.length>1?children[this.moduleName+"."+e[0]].set(e.splice(1).join("."),b,c,d):parent?(checkDefined.call(this,a),parent.set.call(this,a,b,c,d)):(data[d]=c[d]=b,checkValue.call(this,a,b),util.log(['Set "'+d+'" to value',b]),this.unlock(a))},this.override=function(a,b){checkValue.call(this,a,b),util.squelch(!0),this.set(a,b),util.squelch(!1)},this.unset=function(a){checkDefined.call(this,a),util.squelch(!0);var b=this.set(a);return util.squelch(!1),b},this.get=function(a){var b=data[self.moduleName+"."+a];return"undefined"!=typeof b?b:parent?parent.get.call(this,a):data[this.moduleName+"."+a]},this.clear=function(){var a=self.moduleName===this.moduleName?data:arguments[0];if(parent)parent.clear.call(this,a);else{var b=new RegExp("^"+this.moduleName+"\\.[^\\.]*$");for(var c in a)a.hasOwnProperty(c)&&c.match(b)&&(delete a[c],data.hasOwnProperty(c)&&delete data[c])}},this.clearAll=function(){this.clear();for(var a in children)children.hasOwnProperty(a)&&children[a].clearAll()},this.unlock=function(key){var unlockingSubmodule=arguments[1],skipSubKeyCheck=arguments[2];if(parent)parent.unlock.call(this,key,unlockingSubmodule,skipSubKeyCheck);else if("object"==typeof gateMap[key]){var valRegex=/^@\w+$/;for(var namespace in gateMap[key].namespace)if(gateMap[key].namespace.hasOwnProperty(namespace)){var gateObj=gate[namespace],conditions=gateObj.cond,count=0,cond,c,left,right;for(cond in conditions)if(conditions.hasOwnProperty(cond)){c=conditions[cond],left=gateObj.module.get(cond),right=c.val&&c.val.toString().match(valRegex)?gateObj.module.get(c.val.slice(1)):c.val;try{eval("left "+c.operator+" right")&&count++}catch(e){util.throw(e)}}if(count===gateObj.vars.length){util.log("Conditions ["+gateObj.vars.join(",")+'] met for "'+gateObj.module.moduleName+'".',!0);for(var args=[],i=0;i<gateObj.vars.length;i++)args.push(gateObj.module.get(gateObj.vars[i]));if(gateObj.fn.length&&gateObj.fn[1])gateObj.fn[0].apply(gateObj.context,args);else{for(cond in conditions)conditions.hasOwnProperty(cond)&&(delete gateMap[cond].namespace[namespace],gateMap[cond].deps--,cond.indexOf(".")!==-1&&subKeyWaitCount--,0===gateMap[cond].deps&&delete gateMap[cond]);delete gate[namespace],gateObj.fn.apply(gateObj.context,args)}}}}else if(subKeyWaitCount&&!skipSubKeyCheck)for(var gateKey in gateMap)if(gateMap.hasOwnProperty(gateKey)){var split=gateKey.split(".");split&&split.length&&split[split.length-1]===key&&self.unlock(gateKey,!0,!0)}}}var squelch=!1,util={throw:function(a){var b="VarGate Error: "+a;switch(window.DEV_MODE){case"warn":try{console.error(b)}catch(c){}break;case"strict":throw b}},log:function(a,b){var c="VarGate SG1 Log:",d=[];if(window.DEBUG_MODE){"string"!=typeof a&&a.length?d=a:d.push(a),d.unshift(c);try{switch(window.DEBUG_MODE){case"verbose":console.warn.apply(console,d);break;case"static":console.warn.apply(console,JSON.parse(JSON.stringify(d)));break;case"minimal":b&&console.warn.apply(console,d)}}catch(e){}}},squelch:function(a){return"boolean"==typeof a&&(squelch=a),squelch},guid:function(){for(var a=[],b=0;b<256;b++)a[b]=(b<16?"0":"")+b.toString(16);return function(){var b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0,e=4294967295*Math.random()|0;return a[255&b]+a[b>>8&255]+a[b>>16&255]+a[b>>24&255]+"-"+a[255&c]+a[c>>8&255]+"-"+a[c>>16&15|64]+a[c>>24&255]+"-"+a[63&d|128]+a[d>>8&255]+"-"+a[d>>16&255]+a[d>>24&255]+a[255&e]+a[e>>8&255]+a[e>>16&255]+a[e>>24&255]}}()},Gate=new VarGate("vargate");"function"==typeof define&&define.amd?define(function(){return Gate}):"object"==typeof module&&module.exports?module.exports=Gate:window.VarGate=Gate}();