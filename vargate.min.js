/**!
 * VarGate v0.1.0
 * Copyright (c)  Jonathan Perez.
 * Licensed under the MIT License.
 */
!function(){"use strict";function VarGate(module,parent){function getArguments(a){for(var b=[],c=0;c<a.length;c++)console.log("getting ->",self.get(a[c])),b.push(self.get(a[c]));return b}function addCallback(a,b,c,d){var e,f,g,h;"undefined"==typeof gate[a]&&(gate[a]={vars:[],cond:{},fn:c,context:d}),b.length&&"string"!=typeof b?(e=b[0],g=b[1],f=b[2],h="Invalid number of arguments passed through: ["+b.join(",")+"] (should be [key, operator, condition])"):(e=b,g="!==",f="undefined",h='Cannot set "'+JSON.stringify(b)+'" as a property');try{gate[a].vars.push(e),gate[a].cond[e]={operator:g,val:f},"undefined"==typeof gateMap[e]&&(gateMap[e]={deps:0,namespace:{}}),gateMap[e].namespace[a]=!1,gateMap[e].deps++}catch(i){util["throw"](h)}}var self=this,children={},data={},gate={},gateMap={},callback={};this.module=module,this.data=data,this.gate=gate,this.gateMap=gateMap,this.children=children,this.parent=parent,this.register=function(a){var b=this.module===self.module?self.module+"."+a:a;return parent?parent.register.call(this,b):(children[b]=this.children[b]=new VarGate(b,this),children[b])},this["new"]=function(a){return new VarGate(a)},this.when=function(a,b,c){var d=this.module+"."+util.guid();if(a.length&&"string"!=typeof a){for(var e in a)a.hasOwnProperty(e)&&addCallback.call(this,d,a[e],b,c);this.unlock(a[0])}else addCallback.call(this,d,a,b,c),this.unlock(a)},this.set=function(a,b){var c=this.module===self.module?this.module+"."+a:a;parent?("undefined"!=typeof parent.get(a)&&util["throw"]('In "'+this.module+'" variable "'+a+'" defined in module "'+parent.module+'". Choose a different name.'),parent.set.call(this,c,b,a)):(data[c]=this.data[a]=b,this.unlock(arguments[2]||a))},this.get=function(a){var b=data[self.module+"."+a];return parent?"undefined"!=typeof b?b:parent.get.call(this,a):data[this.module+"."+a]},this.unlock=function(key){if("object"==typeof gateMap[key])for(var namespace in gateMap[key].namespace)if(gateMap[key].namespace.hasOwnProperty(namespace)){var gateObj=gate[namespace],conditions=gateObj.cond,count=0,cond,c;for(cond in conditions)if(conditions.hasOwnProperty(cond)){c=conditions[cond];try{eval(this.get(cond)+" "+c.operator+" "+c.val)&&count++}catch(e){try{eval(JSON.stringify(this.get(cond))+" "+c.operator+" "+JSON.stringify(c.val))&&(console.log("stringified"),console.log(JSON.stringify(this.get(cond))+conditions[cond]),count++)}catch(e){util["throw"](e)}}}if(count===gateObj.vars.length)if(console.log("should run the function ",gateObj.fn),gateObj.fn.length&&gateObj.fn[0])gateObj.fn[1].apply(gateObj.context,getArguments(gateObj.vars));else{gateObj.fn.apply(gateObj.context,getArguments(gateObj.vars));for(cond in conditions)conditions.hasOwnProperty(cond)&&(delete gateMap[cond].namespace[namespace],gateMap[cond].deps--,0===gateMap[cond].deps&&delete gateMap[cond]);delete gate[namespace]}}}}var util={"throw":function(a){var b="VarGate Error: "+a;switch(window.DEBUG_MODE){case"warn":console.warn(b);break;case"strict":throw b}},guid:function(){for(var a=[],b=0;b<256;b++)a[b]=(b<16?"0":"")+b.toString(16);var c=Math.random()+1;return function(){var b=c*Math.random()*4294967295|0,d=c*Math.random()*4294967295|0,e=c*Math.random()*4294967295|0,f=c*Math.random()*4294967295|0;return a[255&b]+a[b>>8&255]+a[b>>16&255]+a[b>>24&255]+"-"+a[255&d]+a[d>>8&255]+"-"+a[d>>16&15|64]+a[d>>24&255]+"-"+a[63&e|128]+a[e>>8&255]+"-"+a[e>>16&255]+a[e>>24&255]+a[255&f]+a[f>>8&255]+a[f>>16&255]+a[f>>24&255]}}()},Gate=new VarGate("vargate");"function"==typeof define&&define.amd?define(function(){return Gate}):"object"==typeof module&&module.exports?module.exports=Gate:window.VarGate=Gate}();