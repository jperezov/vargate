/**!
 * vargate v0.2.0
 * Copyright (c)  Jonathan Perez.
 * Licensed under the MIT License.
 */
!function(){"use strict";function VarGate(module,parent){function addCallback(a,b,c,d,e){var f,g,h;"undefined"==typeof gate[a]&&(gate[a]={vars:[],cond:{},fn:c,module:this,context:d||this}),b.length&&"string"!=typeof b?(3!==b.length&&util["throw"]("Invalid number of arguments passed through: ["+b.join(",")+"] (should be [key, operator, condition])"),f=b[0],h=b[1],g=b[2],g&&g.toString().match(/^@\w+$/)&&e!==!0&&addCallback(a,[g.slice(1),h,"@"+f],c,d,!0)):(f=b,h="!==",g=void 0);try{gate[a].vars.push(f),gate[a].cond[f]={operator:h,val:g},"undefined"==typeof gateMap[f]&&(gateMap[f]={deps:0,namespace:{}}),gateMap[f].namespace[a]=!1,gateMap[f].deps++}catch(i){util["throw"]('Cannot set "'+JSON.stringify(b)+'" as a property')}}var self=this,children={},data={},gate={},gateMap={};this.module=module,this.data=data,this.gate=gate,this.gateMap=gateMap,this.children=children,this.parent=parent,this.register=function(a){var b=this.module===self.module?self.module+"."+a:a;return parent?parent.register.call(this,b):(children[b]=this.children[b]=new VarGate(b,this),children[b])},this["new"]=function(a){return new VarGate(a)},this.when=function(a,b,c){var d=this.module+"."+util.guid();if(parent)parent.when.call(this,a,b,c);else if(a.length&&"string"!=typeof a){for(var e in a)a.hasOwnProperty(e)&&addCallback.call(this,d,a[e],b,c);this.unlock(a[0])}else addCallback.call(this,d,a,b,c),this.unlock(a)},this.set=function(a,b){var c=this.module===self.module?this.module+"."+a:arguments[2],d=a.split(".");d&&d.length>1&&children[this.module+"."+d[0]].set(d.splice(1).join(".")),parent?("undefined"!=typeof parent.get(a)&&util["throw"]('In "'+this.module+'" variable "'+a+'" defined in module "'+parent.module+'". Choose a different name.'),parent.set.call(this,a,b,c)):(data[c]=this.data[c]=b,this.unlock(a))},this.get=function(a){var b=data[self.module+"."+a];return parent?"undefined"!=typeof b?b:parent.get.call(this,a):data[this.module+"."+a]},this.unlock=function(key){if(parent)parent.unlock.call(this,key);else if("object"==typeof gateMap[key])for(var namespace in gateMap[key].namespace)if(gateMap[key].namespace.hasOwnProperty(namespace)){var gateObj=gate[namespace],conditions=gateObj.cond,count=0,cond,c,left,right;for(cond in conditions)if(conditions.hasOwnProperty(cond)){c=conditions[cond],left=gateObj.module.get(cond),right=c.val&&c.val.toString().match(/^@\w+$/)?gateObj.module.get(c.val.slice(1)):c.val;try{eval("left "+c.operator+" right")&&count++}catch(e){util["throw"](e)}}if(count===gateObj.vars.length){for(var args=[],i=0;i<gateObj.vars.length;i++)args.push(gateObj.module.get(gateObj.vars[i]));if(gateObj.fn.length&&gateObj.fn[0])gateObj.fn[1].apply(gateObj.context,args);else{gateObj.fn.apply(gateObj.context,args);for(cond in conditions)conditions.hasOwnProperty(cond)&&(delete gateMap[cond].namespace[namespace],gateMap[cond].deps--,0===gateMap[cond].deps&&delete gateMap[cond]);delete gate[namespace]}}}}}var util={"throw":function(a){var b="VarGate Error: "+a;switch(window.DEBUG_MODE){case"warn":console.warn(b);break;case"strict":throw b}},guid:function(){for(var a=[],b=0;b<256;b++)a[b]=(b<16?"0":"")+b.toString(16);var c=Math.random()+1;return function(){var b=c*Math.random()*4294967295|0,d=c*Math.random()*4294967295|0,e=c*Math.random()*4294967295|0,f=c*Math.random()*4294967295|0;return a[255&b]+a[b>>8&255]+a[b>>16&255]+a[b>>24&255]+"-"+a[255&d]+a[d>>8&255]+"-"+a[d>>16&15|64]+a[d>>24&255]+"-"+a[63&e|128]+a[e>>8&255]+"-"+a[e>>16&255]+a[e>>24&255]+a[255&f]+a[f>>8&255]+a[f>>16&255]+a[f>>24&255]}}()},Gate=new VarGate("vargate");"function"==typeof define&&define.amd?define(function(){return Gate}):"object"==typeof module&&module.exports?module.exports=Gate:window.VarGate=Gate}();